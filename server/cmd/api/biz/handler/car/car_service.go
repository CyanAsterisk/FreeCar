// Code generated by hertz generator.

package car

import (
	"context"

	hcar "github.com/CyanAsterisk/FreeCar/server/cmd/api/biz/model/car"
	"github.com/CyanAsterisk/FreeCar/server/cmd/api/config"
	"github.com/CyanAsterisk/FreeCar/server/cmd/api/pkg"
	"github.com/CyanAsterisk/FreeCar/server/shared/consts"
	"github.com/CyanAsterisk/FreeCar/server/shared/errno"
	kcar "github.com/CyanAsterisk/FreeCar/server/shared/kitex_gen/car"
	"github.com/CyanAsterisk/FreeCar/server/shared/tools"
	"github.com/cloudwego/hertz/pkg/app"
	"github.com/cloudwego/hertz/pkg/common/hlog"
)

// AdminCreateCar .
// @router /admin/car/car [PUT]
func AdminCreateCar(ctx context.Context, c *app.RequestContext) {
	var err error
	var req hcar.AdminCreateCarRequest
	resp := new(kcar.CreateCarResponse)
	defer errno.NewSendResponse(c, resp)

	err = c.BindAndValidate(&req)
	if err != nil {
		resp.BaseResp = tools.BuildBaseResp(errno.ParamsErr)
		return
	}

	resp, err = config.GlobalCarClient.CreateCar(ctx, &kcar.CreateCarRequest{PlateNum: req.PlateNum})
	if err != nil {
		hlog.Error("rpc car service err", err)
		resp.BaseResp = tools.BuildBaseResp(errno.ServiceErr)
	}
}

// AdminDeleteCar .
// @router /admin/car/car [DELETE]
func AdminDeleteCar(ctx context.Context, c *app.RequestContext) {
	var err error
	var req hcar.AdminDeleteCarRequest
	resp := new(kcar.DeleteCarResponse)
	defer errno.NewSendResponse(c, resp)

	err = c.BindAndValidate(&req)
	if err != nil {
		resp.BaseResp = tools.BuildBaseResp(errno.ParamsErr)
		return
	}

	resp, err = config.GlobalCarClient.DeleteCar(ctx, &kcar.DeleteCarRequest{
		AccountId: c.MustGet(consts.AccountID).(int64),
		Id:        req.ID,
	})
	if err != nil {
		hlog.Error("rpc car service err", err)
		resp.BaseResp = tools.BuildBaseResp(errno.ServiceErr)
	}
}

// AdminUpdateCar .
// @router /admin/car/car [POST]
func AdminUpdateCar(ctx context.Context, c *app.RequestContext) {
	var err error
	var req hcar.AdminUpdateCarRequest
	resp := new(kcar.AdminUpdateCarResponse)
	defer errno.NewSendResponse(c, resp)

	err = c.BindAndValidate(&req)
	if err != nil {
		resp.BaseResp = tools.BuildBaseResp(errno.ParamsErr)
		return
	}

	resp, err = config.GlobalCarClient.AdminUpdateCar(ctx, &kcar.AdminUpdateCarRequest{
		Id:  req.ID,
		Car: pkg.ConvertCar(req.Car),
	})
	if err != nil {
		hlog.Error("rpc car service err", err)
		resp.BaseResp = tools.BuildBaseResp(errno.ServiceErr)
	}
}

// AdminGetSomeCars .
// @router /admin/car/some [GET]
func AdminGetSomeCars(ctx context.Context, c *app.RequestContext) {
	var err error
	var req hcar.AdminGetSomeCarsRequest
	resp := new(kcar.GetSomeCarsResponse)
	defer errno.NewSendResponse(c, resp)

	err = c.BindAndValidate(&req)
	if err != nil {
		resp.BaseResp = tools.BuildBaseResp(errno.ParamsErr)
		return
	}

	resp, err = config.GlobalCarClient.GetSomeCars(ctx, &kcar.GetSomeCarsRequest{AccountId: c.MustGet(consts.AccountID).(int64)})
	if err != nil {
		hlog.Error("rpc car service err", err)
		resp.BaseResp = tools.BuildBaseResp(errno.ServiceErr)
	}
}

// AdminGetAllCars .
// @router /admin/car/all [GET]
func AdminGetAllCars(ctx context.Context, c *app.RequestContext) {
	var err error
	var req hcar.AdminGetAllCarsRequest
	resp := new(kcar.GetAllCarsResponse)
	defer errno.NewSendResponse(c, resp)

	err = c.BindAndValidate(&req)
	if err != nil {
		resp.BaseResp = tools.BuildBaseResp(errno.ParamsErr)
		return
	}

	resp, err = config.GlobalCarClient.GetAllCars(ctx, &kcar.GetAllCarsRequest{AccountId: c.MustGet(consts.AccountID).(int64)})
	if err != nil {
		hlog.Error("rpc car service err", err)
		resp.BaseResp = tools.BuildBaseResp(errno.ServiceErr)
	}
}

// GetCars .
// @router /mini/car/cars [GET]
func GetCars(ctx context.Context, c *app.RequestContext) {
	var err error
	var req hcar.GetCarsRequest
	resp := new(kcar.GetCarsResponse)
	defer errno.NewSendResponse(c, resp)

	err = c.BindAndValidate(&req)
	if err != nil {
		resp.BaseResp = tools.BuildBaseResp(errno.ParamsErr)
		return
	}

	resp, err = config.GlobalCarClient.GetCars(ctx, &kcar.GetCarsRequest{AccountId: c.MustGet(consts.AccountID).(int64)})
	if err != nil {
		hlog.Error("rpc car service err", err)
		resp.BaseResp = tools.BuildBaseResp(errno.ServiceErr)
	}
}

// GetCar .
// @router /mini/car/car [GET]
func GetCar(ctx context.Context, c *app.RequestContext) {
	var err error
	var req hcar.GetCarRequest
	resp := new(kcar.GetCarResponse)
	defer errno.NewSendResponse(c, resp)

	err = c.BindAndValidate(&req)
	if err != nil {
		resp.BaseResp = tools.BuildBaseResp(errno.ParamsErr)
		return
	}

	resp, err = config.GlobalCarClient.GetCar(ctx, &kcar.GetCarRequest{
		AccountId: c.MustGet(consts.AccountID).(int64),
		Id:        req.ID,
	})
	if err != nil {
		hlog.Error("rpc car service err", err)
		resp.BaseResp = tools.BuildBaseResp(errno.ServiceErr)
	}
}
